{% extends "base.html" %}

{% block title %}Meus Relat칩rios - CEITEC HUB{% endblock %}

{% block content %}
<div class="relatorios-container">
    <h1>游늵 Meu Desempenho</h1>

    <div class="stats-overview">
        <div class="stat-card">
            <h3>Posi칞칚o no Ranking</h3>
            <p class="big-number">{{ posicao_ranking or '-' }}췈</p>
            <small>de {{ total_alunos }} alunos</small>
        </div>
        <div class="stat-card">
            <h3>Pontua칞칚o Total</h3>
            <p class="big-number">{{ pontuacao_total }}</p>
            <small>pontos acumulados</small>
        </div>
    </div>

    <div class="charts-grid">
        <div class="chart-container">
            <h3>Desempenho por M칩dulo</h3>
            <canvas id="modulosChart"></canvas>
        </div>

        <div class="chart-container">
            <h3>Hist칩rico Matem치tica</h3>
            <canvas id="matematicaChart"></canvas>
        </div>
    </div>

    <div class="historico-section">
        <h3>칔ltimas Atividades</h3>

        {% if dados_matematica %}
        <div class="historico-grupo">
            <h4>游빑 Matem치tica</h4>
            <table class="historico-table">
                <tr>
                    <th>Data</th>
                    <th>N칤vel</th>
                    <th>Pontos</th>
                </tr>
                {% for item in dados_matematica[:5] %}
                <tr>
                    <td>{{ item.data_jogo }}</td>
                    <td>{{ item.nivel }}</td>
                    <td>+{{ item.pontuacao }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}

        {% if dados_avaliacao %}
        <div class="historico-grupo">
            <h4>游뱄 Avalia칞칫es IA</h4>
            <table class="historico-table">
                <tr>
                    <th>Data</th>
                    <th>N칤vel</th>
                    <th>Pontos</th>
                </tr>
                {% for item in dados_avaliacao[:5] %}
                <tr>
                    <td>{{ item.data_avaliacao }}</td>
                    <td>{{ item.nivel_classificacao }}</td>
                    <td>+{{ item.pontuacao }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}

        {% if dados_robotica %}
        <div class="historico-grupo">
            <h4>游댢 Projetos de Rob칩tica</h4>
            <table class="historico-table">
                <tr>
                    <th>Projeto</th>
                    <th>츼rea</th>
                    <th>Nota</th>
                </tr>
                {% for item in dados_robotica %}
                <tr>
                    <td>{{ item.titulo }}</td>
                    <td>{{ item.area }}</td>
                    <td>{{ item.nota }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}
    </div>
</div>

<script>
    // Gr치fico de M칩dulos
    const ctxModulos = document.getElementById('modulosChart').getContext('2d');
    new Chart(ctxModulos, {
        type: 'doughnut',
        data: {
            labels: ['Matem치tica', 'Avalia칞칚o IA', 'Rob칩tica'],
            datasets: [{
                data: [
                    {{ (dados_matematica or[]) | sum(attribute = 'pontuacao') }},
                {{ (dados_avaliacao or[]) | sum(attribute = 'pontuacao') }},
        {{ (dados_robotica or[]) | sum(attribute = 'nota') }}
            ],
        backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56']
        }]
    }
});

    // Gr치fico de Hist칩rico Matem치tica
    const ctxMat = document.getElementById('matematicaChart').getContext('2d');
    new Chart(ctxMat, {
        type: 'line',
        data: {
            labels: [{% for item in (dados_matematica or [])[: 7] %}'{{ item.data_jogo[:10] if item.data_jogo else "" }}', {% endfor %}],
    datasets: [{
        label: 'Pontua칞칚o',
        data: [{% for item in (dados_matematica or [])[: 7] %}{ { item.pontuacao } }, {% endfor %}],
    borderColor: '#FF6384',
        tension: 0.4
        }]
    }
});
</script>
{% endblock %}